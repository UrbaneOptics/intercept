require 'csv'
require 'json'
folders = [
  "2011_08_sum",
  "2011_09_sum",
  "2011_10_sum",
  "2011_11_sum",
  "2011_12_sum",
  "2012_01_sum",
  "2012_02_sum",
  "2012_03_sum",
  "2012_04_sum",
  "2012_05_sum",
  "2012_06_sum",
  "2012_07_sum",
  "2012_08_sum",
  "2012_09_sum",
  "2012_10_sum",
  "2012_11_sum",
  "2012_12_sum",
  "2013_01_sum",
  "2013_02_sum",
  "2013_03_sum",
  "2013_04_sum",
  "2013_05_sum",
  "2013_06_sum",
  "2013_07_sum",
  "2013_08_sum",
  "2013_09_sum",
  "2013_10_sum",
  "2013_11_sum",
  "2013_12_sum",
  "2014_01_sum",
  "2014_02_sum",
  "2014_03_sum",
  "2014_04_sum",
  "2014_05_sum",
  "2014_06_sum",
  "2014_07_sum",
  "2014_08_sum",
  "2014_09_sum",
  "2014_10_sum",
  "2014_11_sum",
  "2014_12_sum",
  "2015_01_sum",
  "2015_02_sum",
  "2015_03_sum",
  "2015_04_sum",
  "2015_05_sum",
  "2015_06_sum",
  "2015_07_sum",
  "2015_08_sum",
  "2015_09_sum",
  "2015_10_sum",
  "2015_11_sum",
  "2015_12_sum",
  "2016_01_sum",
  "2016_02_sum",
  "2016_03_sum",
  "2016_04_sum",
  "2016_05_sum",
  "2016_06_sum",
  "2016_07_sum",
  "2016_08_sum",
  "2016_09_sum",
  "2016_10_sum",
  "2016_11_sum",
  "2016_12_sum",
  "2017_01_sum",
  "2017_02_sum",
  "2017_03_sum",
  "2017_04_sum",
  "2017_05_sum",
  "2017_06_sum",
  "2017_07_sum",
  "2017_08_sum",
  "2017_09_sum",
  "2017_10_sum",
  "2017_11_sum",
  "2017_12_sum",
  "2018_01_sum",
  "2018_02_sum",
  "2018_03_sum",
  "2018_04_sum",
  "2018_05_sum",
  "2018_06_sum",
  "2018_07_sum",
  "2018_08_sum",
  "2018_09_sum",
  "2018_10_sum",
  "2018_11_sum",
  "2018_12_sum",
  "2019_01_sum",
  "2019_02_sum",
  "2019_03_sum",
  "2019_04_sum",
  "2019_05_sum",
  "2019_06_sum",
  "2019_07_sum",
  "2019_08_sum",
  "2019_09_sum",
  "2019_10_sum",
  "2019_11_sum",
  "2020_01_sum",
  "2020_02_sum",
  "2020_03_sum",
  "2020_04_sum",
  "2020_05_sum",
  "2020_06_sum",
  "2020_07_sum",
  "2020_08_sum",
  "2020_09_sum",
  "2020_10_sum",
  "2020_11_sum",
  "2020_12_sum",
  "2021_01_sum",
  "2021_02_sum",
  "2021_03_sum",
  "2021_04_sum",
  "2021_05_sum",
  "2021_06_sum",
  "2021_07_sum",
  "2021_08_sum",
  "2021_09_sum",
  "2021_10_sum",
  "2021_11_sum"
]

precinct_files = [
  "001sum.csv",
  "005sum.csv",
  "006sum.csv",
  "007sum.csv",
  "009sum.csv",
  "010sum.csv",
  "013sum.csv",
  "014sum.csv",
  "017sum.csv",
  "018sum.csv",
  "019sum.csv",
  "020sum.csv",
  "022sum.csv",
  "023sum.csv",
  "024sum.csv",
  "025sum.csv",
  "026sum.csv",
  "028sum.csv",
  "030sum.csv",
  "032sum.csv",
  "033sum.csv",
  "034sum.csv",
  "040sum.csv",
  "041sum.csv",
  "042sum.csv",
  "043sum.csv",
  "044sum.csv",
  "045sum.csv",
  "046sum.csv",
  "047sum.csv",
  "048sum.csv",
  "049sum.csv",
  "050sum.csv",
  "052sum.csv",
  "060sum.csv",
  "061sum.csv",
  "062sum.csv",
  "063sum.csv",
  "066sum.csv",
  "067sum.csv",
  "068sum.csv",
  "069sum.csv",
  "070sum.csv",
  "071sum.csv",
  "072sum.csv",
  "073sum.csv",
  "075sum.csv",
  "076sum.csv",
  "077sum.csv",
  "078sum.csv",
  "079sum.csv",
  "081sum.csv",
  "083sum.csv",
  "084sum.csv",
  "088sum.csv",
  "090sum.csv",
  "094sum.csv",
  "100sum.csv",
  "101sum.csv",
  "102sum.csv",
  "103sum.csv",
  "104sum.csv",
  "105sum.csv",
  "106sum.csv",
  "107sum.csv",
  "108sum.csv",
  "109sum.csv",
  "110sum.csv",
  "111sum.csv",
  "112sum.csv",
  "113sum.csv",
  "114sum.csv",
  "115sum.csv",
  "120sum.csv",
  "121sum.csv",
  "122sum.csv",
  "123sum.csv",
  "citysum.csv",
  "cotsum.csv",
  "housingsum.csv",
  "patrolsum.csv",
  "pbbnsum.csv",
  "pbbssum.csv",
  "pbbxsum.csv",
  "pbmnsum.csv",
  "pbmssum.csv",
  "pbqnsum.csv",
  "pbqssum.csv",
  "pbsisum.csv",
  "transitsum.csv"
]

months = {}
files_not_found = []

folders.each do |folder|
  puts "Aggregating violations occuring on #{folder}"
  months[folder] = {}
  precinct_files.each do |pf|
    file_dir = File.join(File.dirname(__FILE__), '../', 'data','csv', folder, pf)
    precinct = pf.sub("sum.csv","")
    months[folder][precinct] = {}
    puts "Reading file from #{file_dir}"

    if File.exists?(file_dir)
      p "File exists"
      file = CSV.read(file_dir)
      file.each_with_index do |line, idx|
        if !line[0].nil? && !line[1].nil?
          months[folder][precinct][line[0]] = line[1]
        end
      end
    else
      p "File does not exist. Adding to files not found"
      files_not_found.append(file_dir.sub('scripts/', '').gsub('../','')) 
    end
  end
end

File.open(File.join(File.dirname(__FILE__), '../', 'data', 'json', "aggregates.json"),"w") do |f|
  f.write(JSON.pretty_generate(months))
end

# Keep track of which precincts are missing stats
File.open(File.join(File.dirname(__FILE__), '../', 'data', 'json', "missing_stats.json"),"w") do |f|
  f.write(JSON.pretty_generate(files_not_found))
end
